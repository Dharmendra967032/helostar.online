<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helostar | Premium 355px Feed</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

    <style>
        :root {
            --bg-color: #050505;
            --card-bg: #111111;
            --helostar-pink: #d3159d;
            --text-white: #ffffff;
            --text-gray: #a0a0a0;
            --glass: rgba(255, 255, 255, 0.05);
            /* Strict Sizing */
            --fixed-width: 355px; 
        }

        body { font-family: 'Inter', sans-serif; background: var(--bg-color); color: var(--text-white); margin: 0; padding: 0; overflow-x: hidden; }
        
        #authOverlay { position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 3000; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(20px); }
        .auth-card { background: var(--card-bg); padding: 40px; border-radius: 24px; border: 1px solid var(--helostar-pink); text-align: center; width: 90%; max-width: 400px; }
        
        header { background: rgba(18, 18, 18, 0.8); backdrop-filter: blur(10px); padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid var(--glass); }
        .logo { font-size: 1.6rem; font-weight: 800; color: var(--helostar-pink); cursor: pointer; letter-spacing: -1px; }
        
        .container { max-width: 1600px; margin: 40px auto; padding: 0 20px 150px 20px; }
        
        /* Grid Layout with fixed column width */
        .video-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, var(--fixed-width)); 
            gap: 25px; 
            justify-content: center; 
        }
        
        /* Fixed Video Card */
        .video-card { 
            background: var(--card-bg); 
            border-radius: 16px; 
            overflow: hidden; 
            border: 1px solid var(--glass); 
            width: var(--fixed-width);
            transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            cursor: pointer; 
        }
        
        .video-card:hover { transform: scale(1.03); border-color: var(--helostar-pink); box-shadow: 0 15px 35px rgba(0,0,0,0.5); }

        /* Force 1:1 Aspect Ratio (9:9) */
        .video-wrapper { 
            position: relative; 
            width: 100%; 
            height: var(--fixed-width); /* Height equals width for perfect square */
            background: #000; 
        }

        video { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
        }

        .video-info { padding: 16px; background: linear-gradient(to top, #111, #181818); }
        .video-title { font-weight: 700; font-size: 1rem; margin-bottom: 6px; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .video-meta { font-size: 0.8rem; color: var(--text-gray); display: flex; justify-content: space-between; align-items: center; }

        /* Theater Mode */
        #theaterMode { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.97); z-index: 4000; justify-content: center; align-items: center; }
        #theaterVideo { width: 90%; max-width: 800px; aspect-ratio: 1/1; max-height: 85vh; border-radius: 12px; border: 1px solid var(--glass); }
        .close-theater { position: absolute; top: 25px; right: 35px; font-size: 2.5rem; color: white; cursor: pointer; }

        .auth-input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 1px solid var(--glass); background: #1a1a1a; color: white; outline: none; }
        .auth-btn { width: 100%; padding: 14px; background: var(--helostar-pink); border: none; color: white; border-radius: 10px; cursor: pointer; font-weight: 800; }
        
        .fab-upload { position: fixed; bottom: 40px; right: 40px; width: 65px; height: 65px; border-radius: 50%; background: var(--helostar-pink); color: white; border: none; cursor: pointer; display: none; align-items: center; justify-content: center; z-index: 1001; box-shadow: 0 10px 25px rgba(211, 21, 157, 0.4); font-size: 1.6rem; }
        #uploadProgress { position: fixed; top: 85px; left: 50%; transform: translateX(-50%); background: var(--helostar-pink); padding: 8px 25px; border-radius: 30px; display: none; z-index: 2001; font-weight: bold; }
    </style>
</head>
<body>

    <div id="authOverlay">
        <div class="auth-card">
            <h1 style="color:var(--helostar-pink); letter-spacing: -2px; font-size: 2.2rem;">HELOSTAR</h1>
            <p style="color:var(--text-gray); margin-bottom: 25px;">Premium Social Media Feed</p>
            <button class="auth-btn" onclick="signInWithGoogle()"><i class="fab fa-google"></i> Login with Google</button>
            <div style="margin: 15px 0; color: var(--text-gray); font-size: 0.8rem;">OR</div>
            <input type="text" id="guestUsername" class="auth-input" placeholder="Guest Nickname">
            <button class="auth-btn" style="background: #252525;" onclick="guestMode()">Guest Access</button>
        </div>
    </div>

    <div id="theaterMode">
        <span class="close-theater" onclick="closeTheater()">&times;</span>
        <video id="theaterVideo" controls autoplay></video>
    </div>

    <div id="uploadProgress">Uploading Content...</div>

    <header>
        <div class="logo" onclick="location.reload()">HELOSTAR</div>
        <input type="text" id="searchInput" class="auth-input" style="margin:0; width: 350px; border-radius: 25px;" placeholder="Search videos..." onkeyup="filterVideos()">
        <button id="logoutBtn" class="auth-btn" style="display:none; width:auto; padding: 8px 20px;" onclick="logout()">Logout</button>
    </header>

    <div class="container">
        <div id="videoContainer" class="video-grid"></div>
    </div>

    <input type="file" id="fileUpload" style="display:none" accept="video/*">
    <button id="uploadBtn" class="fab-upload" onclick="triggerUpload()"><i class="fa fa-plus"></i></button>

<script>
    const SUPABASE_URL = "https://axufucktgyuorwqcykkq.supabase.co"; 
    const SUPABASE_ANON_KEY = "sb_publishable_Vuq82ePGI4vrov2ObLhJQQ_eZRtgkG5"; 

    firebase.initializeApp({
      apiKey: "AIzaSyAd_Gds3NO1NuiWWE7kOUST_epBn_cs2xY",
      authDomain: "helostar-134d9.firebaseapp.com",
      projectId: "helostar-134d9"
    });

    const auth = firebase.auth();
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    let currentUserEmail = null;

    auth.onAuthStateChanged(user => { 
        if (user) startApp(user.email);
        else if (localStorage.getItem('guestUser')) startApp(localStorage.getItem('guestUser'));
    });

    function startApp(email) {
        document.getElementById('authOverlay').style.display = 'none';
        document.getElementById('logoutBtn').style.display = 'block';
        document.getElementById('uploadBtn').style.display = 'flex';
        currentUserEmail = email;
        fetchVideos();
    }

    async function fetchVideos() {
        const { data, error } = await _supabase.from('videos').select('*').order('created_at', { ascending: false });
        if (!error) {
            const container = document.getElementById('videoContainer');
            container.innerHTML = '';
            data.forEach(v => renderVideo(v));
        }
    }

    function renderVideo(video) {
        const card = document.createElement('div');
        card.className = 'video-card';
        card.onclick = () => openTheater(video.url);
        card.innerHTML = `
            <div class="video-wrapper" onmouseenter="hoverPlay(this)" onmouseleave="hoverPause(this)">
                <video src="${video.url}" muted playsinline loop></video>
            </div>
            <div class="video-info">
                <span class="video-title">${video.description || 'Helostar Premium'}</span>
                <div class="video-meta">
                    <span>@${video.owner ? video.owner.split('@')[0] : 'user'}</span>
                    <span><i class="fas fa-play"></i> ${video.views || 0}</span>
                </div>
            </div>`;
        document.getElementById('videoContainer').appendChild(card);
    }

    function openTheater(url) {
        const theater = document.getElementById('theaterMode');
        const tvid = document.getElementById('theaterVideo');
        tvid.src = url;
        theater.style.display = 'flex';
    }

    function closeTheater() {
        const theater = document.getElementById('theaterMode');
        const tvid = document.getElementById('theaterVideo');
        tvid.pause();
        tvid.src = "";
        theater.style.display = 'none';
    }

    function hoverPlay(wrapper) { wrapper.querySelector('video').play(); }
    function hoverPause(wrapper) { 
        const v = wrapper.querySelector('video');
        v.pause(); v.currentTime = 0;
    }

    function triggerUpload() { document.getElementById('fileUpload').click(); }

    document.getElementById('fileUpload').addEventListener('change', async (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const desc = prompt("Enter a video caption:");
        document.getElementById('uploadProgress').style.display = 'block';

        try {
            const fileName = `${Date.now()}_${file.name}`;
            const { data, error: uploadError } = await _supabase.storage.from('video-uploads').upload(fileName, file);
            if (uploadError) throw uploadError;
            const { data: { publicUrl } } = _supabase.storage.from('video-uploads').getPublicUrl(fileName);
            await _supabase.from('videos').insert([{ url: publicUrl, description: desc || "Square Post", owner: currentUserEmail, views: 0, likes: 0 }]);
            location.reload();
        } catch (err) { alert("Upload Failed: " + err.message); } 
        finally { document.getElementById('uploadProgress').style.display = 'none'; }
    });

    function filterVideos() {
        const q = document.getElementById('searchInput').value.toLowerCase();
        document.querySelectorAll('.video-card').forEach(c => {
            c.style.display = c.innerText.toLowerCase().includes(q) ? 'block' : 'none';
        });
    }

    function guestMode() {
        const name = document.getElementById('guestUsername').value || "Guest";
        localStorage.setItem('guestUser', name + "@guest.com");
        location.reload();
    }

    async function signInWithGoogle() {
        const provider = new firebase.auth.GoogleAuthProvider();
        await auth.signInWithPopup(provider);
    }

    function logout() {
        localStorage.clear();
        auth.signOut().then(() => location.reload());
    }
</script>
</body>
</html>