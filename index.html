<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Helostar | Premium</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

    <style>
        :root {
            --bg-color: #000;
            --helostar-pink: #d3159d;
            --glass-white: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.15);
            --blur: blur(25px);
        }

        body { font-family: 'Inter', sans-serif; background: var(--bg-color); color: #fff; margin: 0; overflow-x: hidden; }
        header { background: rgba(0,0,0,0.8); backdrop-filter: var(--blur); padding: 12px 20px; position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid var(--glass-border); }
        .header-content { display: flex; justify-content: space-between; align-items: center; width: 100%; position: relative; }
        .logo { font-size: 1.5rem; font-weight: 900; color: var(--helostar-pink); transition: opacity 0.3s; }

        .search-wrapper { display: flex; align-items: center; flex-grow: 1; justify-content: flex-end; margin-right: 15px; }
        .search-container { position: relative; display: flex; align-items: center; transition: all 0.4s ease; width: 40px; }
        .search-container.expanded { width: 100%; }
        .search-bar { width: 0; opacity: 0; background: var(--glass-white); border: 1px solid var(--glass-border); border-radius: 20px; padding: 8px 10px; color: white; outline: none; transition: all 0.4s ease; pointer-events: none; }
        .search-container.expanded .search-bar { width: 100%; opacity: 1; padding-left: 35px; pointer-events: auto; }
        .search-icon-btn { cursor: pointer; font-size: 1.2rem; color: #fff; position: absolute; left: 10px; z-index: 5; }

        .menu-wrapper { position: relative; }
        .menu-trigger { font-size: 1.5rem; cursor: pointer; color: white; padding-left: 10px; }
        .dropdown-content { 
            position: absolute; right: 0; top: 45px; background: #111; border: 1px solid var(--glass-border); 
            border-radius: 15px; min-width: 200px; display: none; flex-direction: column; overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
        }
        .dropdown-content.show { display: flex; }
        .user-header { padding: 15px; background: #1a1a1a; border-bottom: 1px solid #333; font-size: 0.85rem; color: var(--helostar-pink); font-weight: bold; display: flex; align-items: center; gap: 8px; }
        .dropdown-item { padding: 12px 15px; font-size: 0.9rem; border-bottom: 1px solid #222; cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 10px; }
        .dropdown-item:hover { background: var(--glass-white); }
        .dropdown-item i { width: 20px; color: #888; }
        .logout-item { background: #1a1a1a; color: #ff4d4d; justify-content: center; border-bottom: none; font-size: 1.2rem; padding: 15px; }

        .nav-tabs { display: flex; background: #000; }
        .tab-btn { flex: 1; padding: 15px; background: none; border: none; color: #555; font-weight: 700; cursor: pointer; border-bottom: 2px solid transparent; }
        .tab-btn.active { color: #fff; border-bottom-color: var(--helostar-pink); }
        
        .container { width: 100%; max-width: 500px; margin: 0 auto; padding-bottom: 120px; }
        .card { width: 100%; margin-bottom: 30px; border-bottom: 1px solid #111; }
        .v-wrap { width: 100%; background: #000; position: relative; overflow: hidden; display: flex; align-items: center; }
        .v-full { height: 400px; }
        .v-short { aspect-ratio: 9/16; }
        .v-short.fullscreen-short { position: fixed; inset: 0; aspect-ratio: auto; z-index: 999; width: 100vw; height: 100vh; }
        .v-short.fullscreen-short video { width: 100vw; height: 100vh; object-fit: cover; }
        video { width: 100%; height: 100%; object-fit: contain; }
        
        .action-row { display: flex; gap: 10px; padding: 15px; }
        .btn-act { cursor: pointer; display: flex; align-items: center; gap: 6px; padding: 8px 14px; border-radius: 25px; background: var(--glass-white); border: 1px solid var(--glass-border); font-size: 0.8rem; color: white; border: none; }
        .btn-act:active { transform: scale(0.95); }
        .liked { color: var(--helostar-pink) !important; }
        
        .comm-panel { padding: 15px; display: none; background: rgba(255,255,255,0.05); margin: 0 15px 15px 15px; border-radius: 10px; }
        
        /* Comments UI */
        .comm-panel { display: none; padding: 15px; background: #111; border-top: 1px solid #222; }
        .comm-list { max-height: 150px; overflow-y: auto; margin-bottom: 10px; font-size: 0.85rem; }
        .comm-item { margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px solid #222; }
        .comm-input-wrap { display: flex; gap: 10px; }
        .comm-input { flex: 1; background: #222; border: 1px solid #444; color: white; padding: 8px; border-radius: 5px; outline: none; }
        .comm-post-btn { background: var(--helostar-pink); border: none; color: white; padding: 0 15px; border-radius: 5px; cursor: pointer; }
        .fab { position: fixed; bottom: 30px; right: 25px; width: 60px; height: 60px; background: var(--helostar-pink); border-radius: 50%; display: none; align-items: center; justify-content: center; color: white; border: none; z-index: 1001; box-shadow: 0 4px 15px rgba(211, 21, 157, 0.4); }
        .hidden { display: none !important; }
        #authOverlay { 
            position: fixed; inset: 0; background: linear-gradient(135deg, #0a0a0a 0%, #1a0a2e 50%, #16213e 100%); 
            z-index: 5000; display: flex; flex-direction: column; align-items: center; justify-content: center;
            backdrop-filter: blur(10px);
        }
        #authOverlay::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(circle at 20% 50%, rgba(211, 21, 157, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(211, 21, 157, 0.05) 0%, transparent 50%);
            pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="authOverlay">
        <div style="position: relative; z-index: 10; text-align: center; animation: fadeInDown 0.8s ease;">
            <h1 class="logo" style="font-size: 4rem; margin-bottom: 15px; text-shadow: 0 0 20px rgba(211, 21, 157, 0.4); letter-spacing: 2px;">HELOSTAR</h1>
            <div style="height: 2px; width: 80px; background: linear-gradient(90deg, transparent, var(--helostar-pink), transparent); margin: 0 auto 25px;"></div>
            <p style="font-size: 0.95rem; text-align: center; margin-bottom: 40px; color: var(--helostar-pink); font-style: italic; font-weight: 500; letter-spacing: 1px;">
                "Shine Bright, Share Bold, Inspire Millions" âœ¨
            </p>
            <p style="font-size: 1.15rem; text-align: center; margin-bottom: 40px; color: #ddd; max-width: 320px; line-height: 1.6;">
                Welcome to Helostar! ðŸŽ¬<br>
                <span style="font-size: 0.95rem; color: #aaa; margin-top: 12px; display: block; line-height: 1.7;">
                    Discover amazing short videos and<br>premium content. Sign in to like,<br>comment, and share with our community.
                </span>
            </p>
            <div style="display: flex; flex-direction: column; gap: 15px; margin-top: 35px; width: 100%; align-items: center;">
                <button onclick="signInWithGoogle()" class="btn-act" style="width: 260px; justify-content: center; padding: 14px 20px; background: linear-gradient(135deg, #fff 0%, #f0f0f0 100%); color: #000; font-weight: 600; font-size: 1rem; box-shadow: 0 8px 24px rgba(211, 21, 157, 0.2); transition: all 0.3s ease; border: none;">
                    <i class="fab fa-google" style="margin-right: 10px;"></i> Login with Google
                </button>
                <button onclick="guestMode()" class="btn-act" style="width: 260px; justify-content: center; padding: 14px 20px; background: rgba(255,255,255,0.08); color: #fff; font-weight: 600; font-size: 1rem; border: 1.5px solid rgba(211, 21, 157, 0.4); transition: all 0.3s ease;">
                    <i class="fas fa-user-secret" style="margin-right: 10px;"></i> Continue as Guest
                </button>
            </div>
        </div>
        <style>
            @keyframes fadeInDown {
                from {
                    opacity: 0;
                    transform: translateY(-30px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            #authOverlay .btn-act:hover {
                transform: translateY(-3px);
                box-shadow: 0 12px 32px rgba(211, 21, 157, 0.3) !important;
            }
            #authOverlay .btn-act:active {
                transform: translateY(-1px);
            }
        </style>
    </div>

    <header>
        <div class="header-content">
            <div class="logo" id="headerLogo"><a href="index.html" style="text-decoration: none; color: inherit;">HELOSTAR</a></div>
            <div class="search-wrapper">
                <div class="search-container" id="searchContainer">
                    <i class="fas fa-search search-icon-btn" onclick="toggleSearch()"></i>
                    <input type="text" id="searchInput" class="search-bar" placeholder="Search videos..." oninput="renderFeed()">
                </div>
            </div>
            <div class="menu-wrapper">
                <i class="fas fa-bars menu-trigger" onclick="toggleMenu()"></i>
                <div class="dropdown-content" id="catDropdown">
                    <div class="user-header" id="userDisplay"><i class="fas fa-user-circle"></i> Guest User</div>
    
                    <div class="dropdown-item" onclick="filterByCat('All')"><i class="fas fa-border-all"></i> All Videos</div>
                    <div class="dropdown-item" onclick="filterByCat('Comedy')"><i class="fas fa-laugh"></i> Comedy</div>
                    <div class="dropdown-item" onclick="filterByCat('Party')"><i class="fas fa-music"></i> Party</div>
                    <div class="dropdown-item" onclick="filterByCat('Bhakti')"><i class="fas fa-om"></i> Bhakti</div>
                    <div class="dropdown-item" onclick="filterByCat('Tech')"><i class="fas fa-microchip"></i> Tech</div>
                    <div class="dropdown-item" onclick="filterByCat('Other')"><i class="fas fa-microchip"></i> Other</div>
                     <div class="dropdown-item" ><i></i> Donwnload App</div>
                      <div class="dropdown-item"><a href="indexold.html"></a></i>Old Version</div>
                    <div class="dropdown-item logout-item hidden" id="guestExitBtn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> <span>Exit Guest Mode</span>
                    </div>
                    <div class="dropdown-item logout-item" id="logoutMenuBtn" onclick="logout()" style="display: flex; align-items: center; gap: 10px;"><i class="fas fa-power-off"></i> <span>Logout</span></div>
                </div>
            </div>
        </div>
    </header>

    <div class="nav-tabs">
        <button id="tShort" class="tab-btn active" onclick="setTab('short')">SHORTS</button>
        <button id="tFull" class="tab-btn" onclick="setTab('full')">VIDEOS</button>
    </div>

    <div class="container" id="feed"></div>

    <input type="file" id="fileIn" style="display:none" accept="video/*">
    <button id="uploadBtn" class="fab" onclick="document.getElementById('fileIn').click()"><i class="fa fa-plus"></i></button>

<script>
    // --- CONFIG ---
    const SUPABASE_URL = "https://axufucktgyuorwqcykkq.supabase.co"; 
    const SUPABASE_ANON_KEY = "sb_publishable_Vuq82ePGI4vrov2ObLhJQQ_eZRtgkG5"; 

    firebase.initializeApp({
      apiKey: "AIzaSyAd_Gds3NO1NuiWWE7kOUST_epBn_cs2xY",
      authDomain: "helostar-134d9.firebaseapp.com",
      projectId: "helostar-134d9"
    });

    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    let currentUserEmail = null;
    let currentTab = 'short';
    let currentCat = 'All';
    let isGuest = false;

    // --- AUTH ---
    firebase.auth().onAuthStateChanged(user => {
        if (user) { 
            currentUserEmail = user.email;
            document.getElementById('userDisplay').innerHTML = `<i class="fas fa-user-circle"></i> ${user.displayName || user.email.split('@')[0]}`;
            start(false); 
        } else if (localStorage.getItem('guest')) {
            start(true);
        }
    });

// --- AUTO-PLAY / AUTO-PAUSE LOGIC ---
    const observerOptions = { threshold: 0.6 };
    const videoObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            const vid = entry.target;
            if (entry.isIntersecting) {
                vid.play().catch(() => {});
                incrementView(vid.dataset.id);
            } else {
                vid.pause();
            }
        });
    }, observerOptions);

    function start(g) {
        isGuest = g;
        document.getElementById('authOverlay').classList.add('hidden');
        if(isGuest) {
            document.getElementById('logoutMenuBtn').classList.add('hidden');
            document.getElementById('userDisplay').innerHTML = `<i class="fas fa-user-secret"></i> Guest Mode`;
        } else {
            document.getElementById('uploadBtn').style.display = 'flex';
        }
        renderFeed();
    }

    // --- UPLOAD LOGIC ---
    document.getElementById('fileIn').onchange = async (e) => {
        if(isGuest) return alert("Please login to upload!");
        const file = e.target.files[0];
        if(!file) return;

        const desc = prompt("Enter video description:");
        const category = prompt("Enter category (Comedy, Party, Bhakti, Tech, etc):") || 'All';
        
        alert("Uploading... please wait.");
        const fileName = `${Date.now()}_${file.name}`;
        
        // 1. Upload to Supabase Storage
        const { data: uploadData, error: uploadErr } = await _supabase.storage
            .from('videos')
            .upload(fileName, file);

        if(uploadErr) return alert("Upload failed: " + uploadErr.message);

        // 2. Get Public URL
        const { data: urlData } = _supabase.storage.from('videos').getPublicUrl(fileName);

        // 3. Save to Database
        await _supabase.from('videos').insert([{
            url: urlData.publicUrl,
            description: desc || "No description",
            owner: currentUserEmail,
            category: category,
            likes: 0,
            views: 0
        }]);

        alert("Upload Success!");
        renderFeed();
    };

    // --- INTERACTIONS ---
    async function incrementView(id) {
        // Calls the SQL function created in Supabase
        await _supabase.rpc('increment_views', { row_id: id });
    }
    // --- FEED LOGIC ---
    async function renderFeed() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const feed = document.getElementById('feed');
        feed.innerHTML = '<p style="text-align:center; padding:50px; opacity:0.4;">Loading...</p>';
        
        let q = _supabase.from('videos').select('*').order('created_at', {ascending: false});
        if (currentCat !== 'All') q = q.eq('category', currentCat);
        
        const { data: videos } = await q;
        feed.innerHTML = '';
        if(!videos) return;

        const filtered = videos.filter(v => 
            v.description.toLowerCase().includes(searchTerm) || 
            v.owner.toLowerCase().includes(searchTerm)
        );

        filtered.forEach(v => {
            const vTemp = document.createElement('video');
            vTemp.src = v.url;
            vTemp.onloadedmetadata = () => {
                const isVertical = vTemp.videoHeight > vTemp.videoWidth;
                if ((currentTab === 'short' && isVertical) || (currentTab === 'full' && !isVertical)) {
                    createCard(v, isVertical);
                }
            };
        });
    }

    function createCard(v, isVertical) {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
            <div class="v-wrap ${isVertical ? 'v-short' : 'v-full'}" style="position:relative;">
                <video data-id="${v.id}" src="${v.url}" ${!isVertical ? 'controls' : 'loop playsinline onclick="togglePlay(this)"' }></video>
                ${isVertical ? `<button class="btn-mute" onclick="event.stopPropagation(); toggleMute(this)" style="position:absolute; top:10px; right:10px; background:rgba(0,0,0,0.5); border:none; color:white; padding:8px 12px; border-radius:20px; cursor:pointer; z-index:50;"><i class="fas fa-volume-mute"></i></button>` : ''}
            </div>
            <div class="action-row" ${isVertical ? 'style="position:relative;"' : ''}>
                <button class="btn-act like-btn" data-id="${v.id}" data-liked="false" onclick="event.stopPropagation(); handleLike(this, '${v.id}')">
                    <i class="fas fa-heart"></i> <span class="count">${v.likes || 0}</span>
                </button>
                <button class="btn-act" onclick="event.stopPropagation(); toggleComments('${v.id}')">
                    <i class="fas fa-comment"></i> <span class="comment-count" data-id="${v.id}">0</span>
                </button>
                <button class="btn-act">
                    <i class="fas fa-eye"></i> <span class="view-count" data-id="${v.id}">${v.views || 0}</span>
                </button>
                <button class="btn-act" onclick="event.stopPropagation(); handleShare('${v.url}', '${v.description}')">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
            <div id="comm-panel-${v.id}" class="comm-panel">
                <div id="list-${v.id}" class="comm-list"></div>
                <div class="comm-input-wrap">
                    <input type="text" id="input-${v.id}" class="comm-input" placeholder="Add comment...">
                    <button class="comm-post-btn" onclick="postComment('${v.id}')"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
            <div style="padding:0 15px 15px 15px;">
                <b>@${v.owner?.split('@')[0]}</b> ${v.description}
                <div style="color:var(--helostar-pink); font-size:0.75rem; margin-top:5px;">#${v.category}</div>
            </div>`;
        document.getElementById('feed').appendChild(card);
        
        // Attach video reference and auto-play/pause logic
        const videoElem = card.querySelector('video');
        const vWrap = card.querySelector('.v-wrap');
        const actionRow = card.querySelector('.action-row');
        
        videoElem.onplay = () => pauseAllOtherVideos(videoElem);
        videoElem.onended = () => playNextVideo(card);
        videoObserver.observe(videoElem);
        
        // Add double-click fullscreen for shorts
        if(isVertical) {
            vWrap.ondblclick = () => toggleFullscreenShort(card, vWrap, actionRow);
            
            // Add swipe/touch detection for shorts
            let touchStartY = 0;
            vWrap.addEventListener('touchstart', (e) => {
                touchStartY = e.touches[0].clientY;
            }, false);
            
            vWrap.addEventListener('touchend', (e) => {
                const touchEndY = e.changedTouches[0].clientY;
                const diff = touchStartY - touchEndY;
                
                if(diff > 50) {
                    // Swiped up - go to next video
                    playNextVideo(card);
                } else if(diff < -50) {
                    // Swiped down - go to previous video
                    const prevCard = card.previousElementSibling;
                    if(prevCard && prevCard.classList.contains('card')) {
                        prevCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }
            }, false);
        }
        
        // Load initial comments count and check if user liked
        loadCommentsCount(v.id);
        checkUserLike(v.id);
    }

    function pauseAllOtherVideos(currentVideo) {
        document.querySelectorAll('video').forEach(vid => {
            if (vid !== currentVideo) vid.pause();
        });
    }

    function playNextVideo(currentCard) {
        const nextCard = currentCard.nextElementSibling;
        while(nextCard && !nextCard.classList.contains('card')) {
            nextCard = nextCard.nextElementSibling;
        }
        
        if (nextCard && nextCard.classList.contains('card')) {
            const nextVideo = nextCard.querySelector('video');
            if (nextVideo) {
                // Check if we're in fullscreen mode
                const isInFullscreen = currentCard.classList.contains('fullscreen-active');
                
                if(isInFullscreen) {
                    // Exit fullscreen when video ends
                    const vWrap = currentCard.querySelector('.v-wrap');
                    const actionRow = currentCard.querySelector('.action-row');
                    if(vWrap && vWrap.classList.contains('fullscreen-short')) {
                        toggleFullscreenShort(currentCard, vWrap, actionRow);
                    }
                }
                
                // Auto-swipe/scroll to next video
                setTimeout(() => {
                    nextCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 200);
                
                // Auto-play next video
                setTimeout(() => {
                    nextVideo.play().catch(() => {});
                }, 1200);
            }
        }
    }

    // --- INTERACTIONS ---
    async function incrementView(id) {
        const viewSpan = document.querySelector(`.view-count[data-id="${id}"]`);
        if(viewSpan && !viewSpan.dataset.counted) {
            viewSpan.dataset.counted = 'true';
            let currentViews = parseInt(viewSpan.innerText);
            viewSpan.innerText = currentViews + 1;
            await _supabase.from('videos').update({ views: currentViews + 1 }).eq('id', id);
        }
    }

    async function handleLike(btn, id) {
        if(isGuest) return alert("Login to like!");
        
        const isAlreadyLiked = btn.dataset.liked === 'true';
        if(isAlreadyLiked) return alert("You already liked this video!");

        btn.classList.toggle('liked');
        btn.dataset.liked = 'true';
        const countSpan = btn.querySelector('.count');
        let currentLikes = parseInt(countSpan.innerText);
        
        const newLikes = currentLikes + 1;
        countSpan.innerText = newLikes;

        // Save like to database with user email
        await _supabase.from('videos').update({ likes: newLikes }).eq('id', id);
        
        // Save like record to track user likes
        await _supabase.from('likes').insert([{
            video_id: id,
            user_email: currentUserEmail
        }]).select();
    }

    async function checkUserLike(videoId) {
        if(isGuest) return;
        const { data } = await _supabase.from('likes').select('*').eq('video_id', videoId).eq('user_email', currentUserEmail);
        
        if(data && data.length > 0) {
            const likeBtn = document.querySelector(`.like-btn[data-id="${videoId}"]`);
            if(likeBtn) {
                likeBtn.classList.add('liked');
                likeBtn.dataset.liked = 'true';
            }
        }
    }

    async function loadCommentsCount(videoId) {
        const { data } = await _supabase.from('comments').select('*').eq('video_id', videoId);
        const countSpan = document.querySelector(`.comment-count[data-id="${videoId}"]`);
        if(countSpan) {
            countSpan.innerText = data ? data.length : 0;
        }
    }

    function handleShare(url, desc) {
        if (navigator.share) {
            navigator.share({ title: 'Helostar', text: desc, url: url });
        } else {
            navigator.clipboard.writeText(url);
            alert('Link copied to clipboard!');
        }
    }

    function toggleComments(id) {
        const panel = document.getElementById(`comm-panel-${id}`);
        panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
        if(panel.style.display === 'block') loadComments(id);
    }

    async function loadComments(id) {
        const list = document.getElementById(`list-${id}`);
        const { data } = await _supabase.from('comments').select('*').eq('video_id', id);
        
        if(data && data.length) {
            list.innerHTML = data.map(c => {
                return `<div class="comm-item">${c.comment_text}</div>`;
            }).join('');
        } else {
            list.innerHTML = '<div style="font-size:0.85rem; color:#888;">No comments yet.</div>';
        }
    }

    async function postComment(id) {
        if(isGuest) return alert("Please Login");
        const input = document.getElementById(`input-${id}`);
        if(!input.value.trim()) return;
        
        const commentText = input.value;
        input.value = '';
        input.disabled = true;
        
        try {
            const { error } = await _supabase.from('comments').insert([{ 
                video_id: id, 
                comment_text: commentText
            }]);
            
            if(error) throw error;
            
            await new Promise(r => setTimeout(r, 300));
            await loadComments(id);
            await loadCommentsCount(id);
        } catch(err) {
            console.error('Comment Error:', err);
            alert('Error posting comment: ' + err.message);
            input.value = commentText;
        } finally {
            input.disabled = false;
        }
    }
    function togglePlay(vid) { vid.paused ? vid.play() : vid.pause(); }
    
    function toggleMute(btn) {
        const vid = btn.closest('.v-wrap').querySelector('video');
        vid.muted = !vid.muted;
        btn.innerHTML = vid.muted ? '<i class="fas fa-volume-mute"></i>' : '<i class="fas fa-volume-up"></i>';
    }

    function toggleFullscreenShort(card, vWrap, actionRow) {
        const isFullscreen = vWrap.classList.contains('fullscreen-short');
        
        if(!isFullscreen) {
            // Enter fullscreen
            vWrap.classList.add('fullscreen-short');
            card.classList.add('fullscreen-active');
            actionRow.style.position = 'fixed';
            actionRow.style.bottom = '60px';
            actionRow.style.left = '15px';
            actionRow.style.right = '15px';
            actionRow.style.zIndex = '1000';
            actionRow.style.background = 'transparent';
            actionRow.style.width = 'auto';
            document.body.style.overflow = 'hidden';
            document.body.style.margin = '0';
            document.body.style.padding = '0';
            
            // Style action buttons to be transparent
            actionRow.querySelectorAll('.btn-act').forEach(btn => {
                btn.style.background = 'rgba(0,0,0,0.2)';
                btn.style.border = '1px solid rgba(255,255,255,0.15)';
            });
            
            // Hide other cards
            document.querySelectorAll('.card').forEach(c => {
                if(c !== card) c.style.display = 'none';
            });
            document.querySelector('header').style.display = 'none';
            document.querySelector('.nav-tabs').style.display = 'none';
        } else {
            // Exit fullscreen
            vWrap.classList.remove('fullscreen-short');
            card.classList.remove('fullscreen-active');
            actionRow.style.position = 'relative';
            actionRow.style.bottom = 'auto';
            actionRow.style.left = 'auto';
            actionRow.style.right = 'auto';
            actionRow.style.zIndex = 'auto';
            actionRow.style.background = 'transparent';
            actionRow.style.width = '100%';
            document.body.style.overflow = 'auto';
            document.body.style.margin = '';
            document.body.style.padding = '';
            
            // Reset button styles
            actionRow.querySelectorAll('.btn-act').forEach(btn => {
                btn.style.background = '';
                btn.style.border = '';
            });
            
            // Show all cards and UI
            document.querySelectorAll('.card').forEach(c => c.style.display = 'block');
            document.querySelector('header').style.display = 'block';
            document.querySelector('.nav-tabs').style.display = 'flex';
        }
    }
    
    // --- UI HELPERS ---
    function toggleSearch() {
        const container = document.getElementById('searchContainer');
        const logo = document.getElementById('headerLogo');
        container.classList.toggle('expanded');
        if(container.classList.contains('expanded')) {
            logo.style.opacity = '0';
            document.getElementById('searchInput').focus();
        } else { logo.style.opacity = '1'; }
    }
    function toggleMenu() { document.getElementById('catDropdown').classList.toggle('show'); }
    function filterByCat(cat) { currentCat = cat; toggleMenu(); renderFeed(); }
    function setTab(t) {
        currentTab = t;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(t === 'short' ? 'tShort' : 'tFull').classList.add('active');
        renderFeed();
    }
    function logout() { localStorage.clear(); firebase.auth().signOut().then(() => location.reload()); }
    function guestMode() { localStorage.setItem('guest', '1'); location.reload(); }
    function signInWithGoogle() { firebase.auth().signInWithPopup(new firebase.auth.GoogleAuthProvider()); }

    window.onclick = function(event) {
        if (!event.target.matches('.menu-trigger') && !event.target.closest('.dropdown-content')) {
            const dropdowns = document.getElementsByClassName("dropdown-content");
            for (let d of dropdowns) { if (d.classList.contains('show')) d.classList.remove('show'); }
        }
    }
</script>
</body>
</html>